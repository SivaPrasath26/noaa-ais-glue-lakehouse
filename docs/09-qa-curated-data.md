# AIS January 2024 – Curated Data Validation Report

This document formalizes the complete validation workflow for the **January 2024 curated AIS trajectory dataset**. It consolidates every SQL check, its intent, and final outputs. The goal is to maintain a reproducible QA record covering sampling correctness, density checks, movement classification, time-gap distribution, voyage continuity, and anomaly detection.

---

# 1. Objective

Validate the integrity of the **curated trajectory layer** produced by the PySpark sampling pipeline. The checks confirm:

* correct bucket-based thinning behavior
* correct daily presence
* reasonable sampled row densities
* correct movement vs anchored distribution
* no duplication or runaway volumes
* no artificial time gaps introduced by sampling
* absence of extreme segment-distance anomalies
* voyage ID continuity
* correct first/last-day-span retention

Each section contains:

1. SQL used
2. Purpose
3. Output
4. Interpretation

---

# 2. Check A - Top 10 MMSIs by Total Curated Rows

### Purpose

Identify the highest‑volume MMSIs in the curated layer to validate that sampling is active, deterministic, and non‑inflating.

### SQL

```sql
SELECT mmsi, COUNT(*) AS count
FROM trajectory_points
WHERE year = 2024 AND month = 1
GROUP BY mmsi
ORDER BY count DESC
LIMIT 10;
```

### Output

```
#	mmsi	count
1	367500810	8399
2	367400840	8345
3	319279700	8204
4	367482320	8100
5	367537970	8004
6	319242800	7862
7	319720000	7789
8	338401206	7781
9	366990560	7546
10	368360000	6940

```

### Interpretation

Values in the **7k–9k range** indicate:

* active vessels present most of the month
* correct movement bucket sampling
* no duplication or runaway expansion

---

# 3. Check B - Per‑Day Sampled Density

### Purpose

Ensure each MMSI/day combination has a reasonable number of rows (typically 200–500 for active vessels).

### SQL

```sql
SELECT
    mmsi,
    year,
    month,
    day,
    COUNT(*) AS sampled_rows
FROM trajectory_points
WHERE year = 2024 AND month = 1
GROUP BY mmsi, year, month, day
ORDER BY sampled_rows DESC;
```

### Output

```
#	mmsi	year	month	day	sampled_rows
1	366978690	2024	1	29	394
2	367785930	2024	1	15	390
3	367796610	2024	1	21	390
4	538007465	2024	1	4	373
5	367480260	2024	1	14	371
6	368001440	2024	1	5	369
7	366932120	2024	1	1	366
8	368001440	2024	1	3	366
9	366341000	2024	1	2	364
10	368001440	2024	1	25	362
11	354283000	2024	1	5	360
12	368167220	2024	1	30	359
13	367796610	2024	1	30	359
14	636014610	2024	1	2	358
15	368001440	2024	1	27	358
16	367796610	2024	1	8	357
17	367796610	2024	1	9	354
18	338221000	2024	1	10	352
19	371518000	2024	1	20	350
20	366359000	2024	1	16	347
21	369235000	2024	1	7	346
22	366932120	2024	1	2	345
23	367796610	2024	1	22	341
24	311056900	2024	1	13	341
25	367796610	2024	1	6	340
26	367511590	2024	1	8	338
27	367431280	2024	1	3	338
28	368001440	2024	1	11	337
29	368001440	2024	1	13	335
30	367785930	2024	1	26	334
31	367796610	2024	1	18	332
32	368001440	2024	1	4	331
33	368789000	2024	1	30	330
34	369855000	2024	1	15	330
35	255806491	2024	1	19	330
36	368139280	2024	1	26	330
37	311070400	2024	1	30	330
38	367785930	2024	1	29	326
39	367796610	2024	1	20	326
40	563027400	2024	1	26	325
41	316018477	2024	1	2	325
42	366999713	2024	1	3	324
43	366938710	2024	1	7	323
44	366999712	2024	1	13	323
45	219153000	2024	1	20	323
46	367480260	2024	1	16	323
47	367588290	2024	1	4	322
48	477468600	2024	1	25	322
49	368226910	2024	1	5	321
50	366341000	2024	1	12	321
51	369580000	2024	1	28	321
52	563190800	2024	1	29	321
53	353434000	2024	1	17	321
54	389908000	2024	1	11	321
55	367161960	2024	1	30	320
56	366938780	2024	1	5	320
57	368001440	2024	1	12	319
58	538003678	2024	1	7	319
59	636021197	2024	1	7	319
60	316014060	2024	1	2	319
61	366991514	2024	1	18	319
62	367796610	2024	1	7	318
63	338221000	2024	1	5	318
64	309822000	2024	1	8	317
65	368139280	2024	1	25	317
66	368001440	2024	1	28	316
67	255806497	2024	1	20	315
68	316034846	2024	1	4	314
69	636013239	2024	1	12	314
70	367362010	2024	1	9	314
71	636015177	2024	1	14	314
72	316286000	2024	1	19	314
73	311000898	2024	1	20	313
74	369234000	2024	1	21	312
75	374696000	2024	1	23	312
76	311000321	2024	1	20	310
77	369225000	2024	1	20	310
78	538003678	2024	1	6	310
79	636016445	2024	1	7	310
80	367480260	2024	1	5	310
81	367511590	2024	1	1	310
82	368247000	2024	1	29	309
83	367000140	2024	1	21	309
84	366791990	2024	1	18	309
85	563079000	2024	1	7	309
86	538071854	2024	1	13	309
87	305176000	2024	1	15	309
88	368251670	2024	1	9	309
89	319279700	2024	1	13	308
90	338866000	2024	1	3	308
91	367533290	2024	1	11	308
92	367341010	2024	1	4	308
93	368251670	2024	1	25	307
94	338137000	2024	1	10	307
95	357194000	2024	1	25	307
96	256604000	2024	1	25	307
97	366932120	2024	1	5	307
98	367353070	2024	1	20	306
99	477326600	2024	1	14	306
100	368251670	2024	1	20	306

```

### Interpretation

* High density (~300–400/day) is expected for harbor vessels.
* No values >2000/day → sampling is functioning.
* Presence of multi‑day continuity is correct.

---

# 4. Check C - Movement vs Anchored Distribution

### Purpose

Detect MMSIs incorrectly classified as always-movement or always-anchored.

### SQL

```sql
SELECT
    mmsi,
    SUM(CASE WHEN movement_state = 'moving' THEN 1 ELSE 0 END) AS moving_pts,
    SUM(CASE WHEN movement_state = 'anchored' THEN 1 ELSE 0 END) AS anchored_pts,
    COUNT(*) AS total_pts,
    ROUND(100.0 * SUM(CASE WHEN movement_state = 'moving' THEN 1 ELSE 0 END) / COUNT(*), 2) AS pct_moving
FROM trajectory_points
WHERE year = 2024 AND month = 1
GROUP BY mmsi
ORDER BY pct_moving DESC
LIMIT 20;
```

### Output 

```
#	mmsi	moving_pts	anchored_pts	total_pts	pct_moving
1	338454303	11	0	11	100.0
2	368290230	137	0	137	100.0
3	636024416	1	0	1	100.0
4	338457048	2	0	2	100.0
5	338229631	82	0	82	100.0
6	636017045	369	0	369	100.0
7	368339260	12	0	12	100.0
8	368186010	121	0	121	100.0
9	338229034	28	0	28	100.0
10	538005959	171	0	171	100.0
11	983103845	8	0	8	100.0
12	259739000	243	0	243	100.0
13	352001003	240	0	240	100.0
14	338321329	235	0	235	100.0
15	338368567	81	0	81	100.0
16	338105966	118	0	118	100.0
17	368340450	386	0	386	100.0
18	477925400	44	0	44	100.0
19	351434000	170	0	170	100.0
20	574005430	10	0	10	100.0

```

### Interpretation 

* 100% moving MMSIs usually represent small fast craft or incomplete days.
* Expected distribution: mixed anchored/moving for large vessels.

---

# 5. Check D - Time‑Gap Distribution

### Purpose

Verify that thinning produces expected temporal gaps:

* ~600 sec for 10‑min buckets
* ~900 sec for 15‑min buckets
* ~86400 sec only for pure daily endpoints

### SQL

```sql
SELECT
    mmsi,
    year,
    month,
    day,
    AVG(time_diff_sec) AS avg_gap_sec,
    MIN(time_diff_sec) AS min_gap_sec,
    MAX(time_diff_sec) AS max_gap_sec
FROM (
    SELECT
        mmsi,
        year,
        month,
        day,
        basedatetime,
        LAG(basedatetime) OVER (
            PARTITION BY mmsi, year, month, day ORDER BY basedatetime
        ) AS prev_dt,
        DATE_DIFF('second',
                  LAG(basedatetime) OVER (
                      PARTITION BY mmsi, year, month, day ORDER BY basedatetime
                  ),
                  basedatetime) AS time_diff_sec
    FROM curated_trajectory
    WHERE year = 2024 AND month = 1
)
WHERE prev_dt IS NOT NULL
GROUP BY mmsi, year, month, day
ORDER BY avg_gap_sec DESC;
```

### Output 

```

#	mmsi	year	month	day	avg_gap_sec	min_gap_sec	max_gap_sec
1	367558580	2024	1	29	86399.0	86399	86399
2	369970763	2024	1	15	86399.0	86399	86399
3	368075180	2024	1	12	86399.0	86399	86399
4	367649730	2024	1	2	86399.0	86399	86399
5	367121040	2024	1	29	86399.0	86399	86399
6	366946000	2024	1	28	86399.0	86399	86399
7	338400249	2024	1	22	86399.0	86399	86399
8	367512520	2024	1	3	86399.0	86399	86399
9	316050493	2024	1	2	86399.0	86399	86399
10	338424194	2024	1	6	86399.0	86399	86399
11	367791010	2024	1	27	86399.0	86399	86399
12	366938440	2024	1	9	86399.0	86399	86399
13	367467120	2024	1	5	86399.0	86399	86399
14	563190800	2024	1	26	86399.0	86399	86399
15	367331210	2024	1	23	86399.0	86399	86399
16	367155810	2024	1	7	86399.0	86399	86399
17	368236120	2024	1	26	86399.0	86399	86399
18	338424194	2024	1	5	86399.0	86399	86399
19	319848000	2024	1	16	86399.0	86399	86399
20	368071290	2024	1	15	86399.0	86399	86399
21	338144542	2024	1	27	86399.0	86399	86399
22	367301450	2024	1	12	86399.0	86399	86399
23	367762190	2024	1	21	86399.0	86399	86399
24	368221920	2024	1	16	86399.0	86399	86399
25	368267990	2024	1	15	86399.0	86399	86399
26	368260290	2024	1	6	86399.0	86399	86399
27	368275830	2024	1	12	86399.0	86399	86399
28	367301450	2024	1	15	86399.0	86399	86399
29	338353642	2024	1	1	86399.0	86399	86399
30	368260290	2024	1	29	86399.0	86399	86399
31	367485290	2024	1	4	86399.0	86399	86399
32	367307370	2024	1	11	86399.0	86399	86399
33	368210940	2024	1	12	86399.0	86399	86399
34	319848000	2024	1	29	86399.0	86399	86399
35	367071470	2024	1	26	86399.0	86399	86399
36	367349770	2024	1	1	86399.0	86399	86399
37	367133960	2024	1	16	86399.0	86399	86399
38	369996000	2024	1	25	86399.0	86399	86399
39	368165770	2024	1	12	86399.0	86399	86399
40	319079300	2024	1	8	86399.0	86399	86399
41	371705000	2024	1	3	86399.0	86399	86399
42	366967690	2024	1	3	86399.0	86399	86399
43	338248304	2024	1	13	86399.0	86399	86399
44	367575990	2024	1	23	86399.0	86399	86399
45	316001538	2024	1	19	86399.0	86399	86399
46	368090720	2024	1	8	86399.0	86399	86399
47	316012046	2024	1	6	86399.0	86399	86399
48	368021110	2024	1	30	86399.0	86399	86399
49	367531670	2024	1	27	86399.0	86399	86399
50	367840000	2024	1	4	86399.0	86399	86399
51	367515860	2024	1	18	86399.0	86399	86399
52	367533950	2024	1	18	86399.0	86399	86399
53	367362000	2024	1	25	86399.0	86399	86399
54	367533950	2024	1	29	86399.0	86399	86399
55	367158250	2024	1	26	86399.0	86399	86399
56	367787130	2024	1	1	86399.0	86399	86399
57	338300496	2024	1	23	86399.0	86399	86399
58	319511000	2024	1	3	86399.0	86399	86399
59	367331730	2024	1	10	86399.0	86399	86399
60	367369720	2024	1	17	86399.0	86399	86399
61	367790730	2024	1	17	86399.0	86399	86399
62	367380940	2024	1	13	86399.0	86399	86399
63	367306390	2024	1	20	86399.0	86399	86399
64	319079300	2024	1	28	86399.0	86399	86399
65	369970763	2024	1	11	86399.0	86399	86399
66	868233290	2024	1	26	86399.0	86399	86399
67	367702220	2024	1	1	86399.0	86399	86399
68	338395832	2024	1	7	86399.0	86399	86399
69	366958670	2024	1	1	86399.0	86399	86399
70	367017440	2024	1	7	86399.0	86399	86399
71	338300496	2024	1	21	86399.0	86399	86399
72	368756000	2024	1	1	86399.0	86399	86399
73	338206398	2024	1	9	86399.0	86399	86399
74	367513220	2024	1	1	86399.0	86399	86399
75	367150450	2024	1	28	86399.0	86399	86399
76	367790730	2024	1	28	86399.0	86399	86399
77	367795910	2024	1	12	86399.0	86399	86399
78	338353642	2024	1	25	86399.0	86399	86399
79	369996000	2024	1	27	86399.0	86399	86399
80	367568020	2024	1	11	86399.0	86399	86399
81	338424194	2024	1	15	86399.0	86399	86399
82	367150450	2024	1	13	86399.0	86399	86399
83	316003703	2024	1	29	86399.0	86399	86399
84	367581150	2024	1	22	86399.0	86399	86399
85	367730160	2024	1	11	86399.0	86399	86399
86	367741150	2024	1	1	86399.0	86399	86399
87	538009735	2024	1	27	86399.0	86399	86399
88	316023959	2024	1	20	86399.0	86399	86399
89	367627320	2024	1	17	86399.0	86399	86399
90	367707590	2024	1	11	86399.0	86399	86399
91	367560930	2024	1	16	86399.0	86399	86399
92	367468270	2024	1	16	86399.0	86399	86399
93	338118255	2024	1	5	86399.0	86399	86399
94	367642860	2024	1	15	86399.0	86399	86399
95	338127553	2024	1	30	86399.0	86399	86399
96	367521570	2024	1	17	86399.0	86399	86399
97	367170860	2024	1	15	86399.0	86399	86399
98	367719830	2024	1	7	86399.0	86399	86399
99	367778530	2024	1	18	86399.0	86399	86399
100	367662000	2024	1	8	86399.0	86399	86399

```

### Interpretation 

* Days showing **86399 sec** (24h gaps) represent daily endpoints only.
* Presence of normal 600–900 sec gaps confirms bucket logic.

---

# 6. Check E - Segment Distance Outlier Detection

### Purpose

Identify large jumps that exceed physical vessel movement, usually from missing day endpoints or incorrect previous‑point linkage.

### SQL

```sql
SELECT
    mmsi,
    year,
    month,
    day,
    basedatetime,
    segmentdistancekm
FROM trajectory_points
WHERE year = 2024 AND month = 1
  AND segmentdistancekm > 20
ORDER BY segmentdistancekm DESC;
```

### Output 

```
#	mmsi	year	month	day	basedatetime	segmentdistancekm
1	367668180	2024	1	12	2024-01-12 16:38:58.000	8626.272987023509
2	0	2024	1	10	2024-01-10 23:59:14.000	8348.335900750251
3	0	2024	1	20	2024-01-20 23:59:24.000	8228.723843718917
4	0	2024	1	20	2024-01-20 00:14:05.000	8226.476999484516
5	0	2024	1	19	2024-01-19 23:59:43.000	8224.442557465241
6	0	2024	1	15	2024-01-15 23:59:33.000	8221.764703553456
7	0	2024	1	15	2024-01-15 22:14:05.000	8221.389292663149
8	0	2024	1	16	2024-01-16 00:28:57.000	8218.880630789141
9	0	2024	1	18	2024-01-18 23:59:03.000	8212.745986067754
10	0	2024	1	10	2024-01-10 00:59:11.000	8211.175759025407
11	0	2024	1	16	2024-01-16 23:59:54.000	8206.188660018284
12	538071416	2024	1	3	2024-01-03 19:26:56.000	5564.646406753902
13	538071416	2024	1	2	2024-01-02 23:49:27.000	5563.573642939791
14	538071416	2024	1	3	2024-01-03 18:39:03.000	5545.477770086698
15	338346168	2024	1	30	2024-01-30 23:58:22.000	5407.926365337446
16	338167545	2024	1	30	2024-01-30 22:59:40.000	5343.814392547688
17	338167545	2024	1	30	2024-01-30 14:50:51.000	5340.943608502327
18	338346168	2024	1	26	2024-01-26 23:58:28.000	5330.038734287425
19	338346168	2024	1	26	2024-01-26 16:52:12.000	5281.668988141377
20	338346168	2024	1	30	2024-01-30 16:36:29.000	4768.527884198013
21	367751630	2024	1	22	2024-01-22 12:03:55.000	4622.00282150858
22	367751630	2024	1	22	2024-01-22 16:51:06.000	4622.001709559752
23	367751630	2024	1	22	2024-01-22 13:08:25.000	4622.001709559423
24	367751630	2024	1	22	2024-01-22 16:39:24.000	4622.000597610157
25	987654321	2024	1	16	2024-01-16 23:58:30.000	4509.67874833224
26	367078250	2024	1	8	2024-01-08 01:15:19.000	4448.375284841302
27	367078250	2024	1	8	2024-01-08 01:29:31.000	4447.974978308996
28	366999411	2024	1	13	2024-01-13 15:00:07.000	4447.864895171293
29	366999411	2024	1	19	2024-01-19 14:44:21.000	4447.787058651038
30	367658890	2024	1	4	2024-01-04 08:44:44.000	4447.759259514726
31	366999411	2024	1	19	2024-01-19 14:45:31.000	4447.675864281204
32	367658890	2024	1	4	2024-01-04 07:31:17.000	4447.666972774249
33	366999411	2024	1	13	2024-01-13 15:14:08.000	4446.45166687529
34	248403000	2024	1	13	2024-01-13 10:10:58.000	4445.0360077746
35	303599000	2024	1	10	2024-01-10 23:59:55.000	4420.173480002956
36	303599000	2024	1	11	2024-01-11 00:00:01.000	4419.947228155663
37	303599000	2024	1	11	2024-01-11 23:59:45.000	4383.059752225748
38	303599000	2024	1	18	2024-01-18 11:44:39.000	4381.699491798813
39	538005048	2024	1	23	2024-01-23 12:09:55.000	4379.694258454258
40	538005048	2024	1	23	2024-01-23 12:11:06.000	4377.040406537083
41	374158000	2024	1	23	2024-01-23 23:59:47.000	4335.810549030339
42	374158000	2024	1	24	2024-01-24 00:00:00.000	4335.469195294382
43	303599000	2024	1	10	2024-01-10 08:44:25.000	4334.853189202724
44	303599000	2024	1	18	2024-01-18 23:59:45.000	4309.3868162373865
45	374158000	2024	1	23	2024-01-23 11:40:13.000	4287.679768068539
46	987654321	2024	1	15	2024-01-15 00:04:30.000	4233.1817195686235
47	987654321	2024	1	15	2024-01-15 12:13:51.000	4232.798774079818
48	0	2024	1	9	2024-01-09 16:29:54.000	4212.743629290483
49	0	2024	1	9	2024-01-09 16:16:43.000	4208.7727264151
50	303599000	2024	1	19	2024-01-19 15:10:18.000	4190.599011497766
51	374158000	2024	1	24	2024-01-24 23:59:45.000	4182.337418143577
52	374158000	2024	1	25	2024-01-25 16:59:26.000	4182.132377211625
53	987654321	2024	1	14	2024-01-14 20:01:10.000	4136.300940717838
54	303599000	2024	1	28	2024-01-28 18:44:20.000	4105.052443166341
55	303599000	2024	1	28	2024-01-28 23:59:35.000	4104.8182706955085
56	303599000	2024	1	19	2024-01-19 23:59:24.000	4103.824429971471
57	374158000	2024	1	16	2024-01-16 13:59:07.000	4042.4126644903495
58	374158000	2024	1	22	2024-01-22 23:59:45.000	4029.432033189198
59	374158000	2024	1	29	2024-01-29 23:59:45.000	3997.002345760922
60	0	2024	1	4	2024-01-04 22:28:57.000	3996.7626091807865
61	0	2024	1	4	2024-01-04 23:58:53.000	3996.7623884254604
62	366956000	2024	1	23	2024-01-23 21:54:30.000	3990.526298852176
63	366956000	2024	1	8	2024-01-08 17:13:51.000	3990.5100325259946
64	366956000	2024	1	8	2024-01-08 21:08:24.000	3990.3779376047914
65	374158000	2024	1	16	2024-01-16 23:59:45.000	3979.372062439908
66	374158000	2024	1	27	2024-01-27 23:59:45.000	3932.7297668589595
67	374158000	2024	1	28	2024-01-28 00:00:41.000	3932.334847177647
68	211002010	2024	1	27	2024-01-27 20:29:02.000	3903.9259029061204
69	211002010	2024	1	27	2024-01-27 23:54:17.000	3902.5485523125813
70	338231624	2024	1	10	2024-01-10 01:01:19.000	3897.1824997347185
71	248403000	2024	1	13	2024-01-13 11:16:02.000	3894.0813970105833
72	374158000	2024	1	17	2024-01-17 00:14:01.000	3814.6500584037203
73	338236311	2024	1	11	2024-01-11 00:04:32.000	3783.8401917535025
74	338236311	2024	1	4	2024-01-04 23:54:11.000	3783.834062652049
75	338236311	2024	1	4	2024-01-04 21:32:14.000	3783.8335050975047
76	338236311	2024	1	10	2024-01-10 23:44:38.000	3783.8235458998456
77	374158000	2024	1	22	2024-01-22 00:13:31.000	3671.93876849301
78	374158000	2024	1	22	2024-01-22 00:02:47.000	3666.5696742413907
79	987654321	2024	1	8	2024-01-08 19:33:39.000	3632.70775832423
80	987654321	2024	1	8	2024-01-08 23:58:30.000	3631.9025357469027
81	211002010	2024	1	24	2024-01-24 23:51:17.000	3627.664295294814
82	211002010	2024	1	24	2024-01-24 16:08:26.000	3620.7908205073354
83	368124160	2024	1	20	2024-01-20 00:00:57.000	3589.999836348808
84	368124160	2024	1	19	2024-01-19 23:58:19.000	3589.999757505763
85	374158000	2024	1	21	2024-01-21 00:01:36.000	3539.638932954679
86	374158000	2024	1	20	2024-01-20 23:59:45.000	3539.390571762688
87	338346168	2024	1	16	2024-01-16 23:59:20.000	3495.1726718227224
88	248403000	2024	1	13	2024-01-13 01:58:59.000	3459.5369335390014
89	248403000	2024	1	13	2024-01-13 01:53:42.000	3459.0520628272197
90	338346168	2024	1	25	2024-01-25 17:12:03.000	3449.6621390571245
91	338346168	2024	1	25	2024-01-25 22:52:23.000	3448.014827505806
92	338000000	2024	1	24	2024-01-24 19:31:48.000	3444.6933504901717
93	338000000	2024	1	24	2024-01-24 16:28:47.000	3443.0251889223537
94	338217318	2024	1	12	2024-01-12 15:22:34.000	3394.968507658157
95	311001094	2024	1	28	2024-01-28 15:54:31.000	3336.8939168761267
96	338217318	2024	1	12	2024-01-12 16:13:16.000	3330.646392963727
97	311027100	2024	1	11	2024-01-11 17:02:14.000	3268.2535317034435
98	311027100	2024	1	12	2024-01-12 04:47:54.000	3235.6248599703026
99	311027100	2024	1	12	2024-01-12 05:04:46.000	3228.3565022252196
100	311027100	2024	1	12	2024-01-12 03:13:30.000	3203.2567225179414

```

### Interpretation 

* Values in thousands of km indicate that previous‑sample linkage is wrong.
* Often caused by MMSI=0 or malformed timestamps.

---

# 7. Check F - Voyage Continuity

### Purpose

Verify voyage_ID behavior after sampling and ensure no spurious voyage splits.

### SQL

```sql
SELECT
    mmsi,
    MIN(voyageid) AS min_voy,
    MAX(voyageid) AS max_voy,
    COUNT(DISTINCT voyageid) AS total_voyages,
    COUNT(*) AS sampled_rows
FROM trajectory_points
WHERE year = 2024 AND month = 1
GROUP BY mmsi
ORDER BY total_voyages DESC;
```

### Output 

```

#	mmsi	min_voy	max_voy	total_voyages	sampled_rows
1	367770120	0	63	63	1226
2	366988310	0	65	63	809
3	368010460	0	63	63	462
4	368236260	0	59	60	2709
5	367308780	0	57	58	1196
6	316006859	0	57	58	762
7	368295630	0	57	58	608
8	338321456	0	56	57	1207
9	338184034	0	56	57	1018
10	367495030	0	56	57	166
11	367544620	0	55	56	1526
12	367712090	0	58	56	390
13	367662450	0	55	56	396
14	316030298	0	58	56	398
15	368164540	0	54	55	1723
16	316029172	0	54	55	1188
17	367448070	0	53	54	1943
18	338093069	0	55	53	334
19	368260070	0	52	53	375
20	368071490	0	60	52	433
21	338172899	0	51	52	1279
22	367446540	0	51	52	1926
23	367812300	0	50	51	1123
24	338445233	0	62	51	82
25	368120080	0	50	50	2062
26	367104030	0	50	50	2085
27	369493024	0	54	49	407
28	316011736	0	51	49	864
29	319272800	0	48	49	1363
30	338442863	0	50	49	221
31	338303073	0	59	49	60
32	338235704	0	47	48	2269
33	367748680	0	46	47	1238
34	368207090	0	46	47	1731
35	368203490	0	47	47	1061
36	338163877	0	46	46	258
37	368200880	0	45	46	888
38	368060270	0	45	46	760
39	367406770	0	45	46	2497
40	338301189	0	45	46	611
41	366868360	0	45	46	4324
42	316033909	0	62	45	58
43	367654140	0	46	45	284
44	367434630	0	45	45	925
45	316037266	0	44	45	399
46	367772890	0	52	44	320
47	367773370	0	45	44	452
48	367463990	0	44	44	960
49	366999634	0	43	44	343
50	368115620	0	43	44	1115
51	338446637	0	48	44	58
52	368221890	0	63	44	58
53	367434160	0	43	44	3404
54	338391954	0	83	44	60
55	316050801	0	45	44	268
56	367604770	0	43	44	1377
57	367057450	0	52	43	58
58	368075390	0	42	43	2832
59	368187810	0	52	43	56
60	366933650	0	53	43	60
61	367186630	0	42	43	793
62	367154000	0	53	43	57
63	367712580	0	42	43	798
64	368062770	0	48	43	59
65	367747610	0	42	43	2496
66	316024446	0	51	43	991
67	316030627	0	41	42	1121
68	367002210	0	41	42	1623
69	316049288	0	41	42	1540
70	367351740	0	41	42	1699
71	368100180	0	58	42	142
72	367686970	0	43	42	196
73	367339130	0	42	42	545
74	367745320	0	41	42	1509
75	338428075	0	55	42	83
76	367605280	0	41	42	672
77	316001152	0	42	42	1976
78	316039864	0	41	42	1516
79	369493065	0	50	42	246
80	367094010	0	40	41	424
81	367701480	0	46	41	104
82	369990206	0	41	41	158
83	316043959	0	43	41	156
84	368135910	0	41	41	581
85	338107575	0	46	41	59
86	368237040	0	48	41	51
87	368122350	0	40	41	877
88	367426920	0	41	41	637
89	368263940	0	40	41	55
90	368035480	0	40	41	383
91	366919640	0	44	41	505
92	368138280	0	51	41	55
93	367467010	0	44	41	268
94	338401259	0	42	41	57
95	368169940	0	39	40	814
96	367654260	0	40	40	1678
97	366863240	0	39	40	2672
98	367419130	0	41	40	390
99	367688810	0	39	40	70
100	368259780	0	39	40	497

```

### Interpretation 

* High voyage counts (50+) may indicate aggressive day-based splits.
* Expected for vessels with frequent port calls.

---

# 8. Check G - Day Boundary Span

### Purpose

Detect days where first and last timestamps are too close (missing anchors).

### SQL

```sql
WITH boundaries AS (
    SELECT
        mmsi,
        year,
        month,
        day,
        MIN(basedatetime) AS first_ts,
        MAX(basedatetime) AS last_ts
    FROM trajectory_points
    WHERE year = 2024 AND month = 1
    GROUP BY mmsi, year, month, day
)
SELECT *
FROM boundaries
WHERE DATE_DIFF('minute', first_ts, last_ts) < 5
ORDER BY mmsi, day;
```

### Output Placeholder

```
#	mmsi	year	month	day	first_ts	last_ts
1	11	2024	1	17	2024-01-17 13:03:32.000	2024-01-17 13:06:33.000
2	111	2024	1	6	2024-01-06 01:35:07.000	2024-01-06 01:35:07.000
3	111	2024	1	30	2024-01-30 23:23:21.000	2024-01-30 23:23:21.000
4	4061	2024	1	18	2024-01-18 17:20:38.000	2024-01-18 17:20:38.000
5	3071712	2024	1	22	2024-01-22 01:19:02.000	2024-01-22 01:19:02.000
6	3381234	2024	1	26	2024-01-26 01:18:21.000	2024-01-26 01:19:26.000
7	3669704	2024	1	26	2024-01-26 19:20:41.000	2024-01-26 19:20:41.000
8	3791472	2024	1	19	2024-01-19 07:26:23.000	2024-01-19 07:26:23.000
9	3791472	2024	1	28	2024-01-28 03:47:53.000	2024-01-28 03:47:53.000
10	4556531	2024	1	1	2024-01-01 21:16:34.000	2024-01-01 21:16:34.000
11	4556533	2024	1	25	2024-01-25 19:52:57.000	2024-01-25 19:52:57.000
12	4558964	2024	1	14	2024-01-14 23:50:36.000	2024-01-14 23:50:36.000
13	4558964	2024	1	15	2024-01-15 00:26:37.000	2024-01-15 00:26:37.000
14	7751005	2024	1	9	2024-01-09 00:10:30.000	2024-01-09 00:10:30.000
15	7751005	2024	1	22	2024-01-22 21:06:00.000	2024-01-22 21:06:00.000
16	11262015	2024	1	5	2024-01-05 20:50:35.000	2024-01-05 20:53:35.000
17	14038642	2024	1	18	2024-01-18 15:46:55.000	2024-01-18 15:46:55.000
18	31580292	2024	1	8	2024-01-08 03:47:59.000	2024-01-08 03:47:59.000
19	31772190	2024	1	9	2024-01-09 08:01:01.000	2024-01-09 08:01:01.000
20	31862704	2024	1	28	2024-01-28 19:59:24.000	2024-01-28 19:59:24.000
21	32104466	2024	1	22	2024-01-22 06:10:11.000	2024-01-22 06:10:11.000
22	32606548	2024	1	8	2024-01-08 23:18:28.000	2024-01-08 23:18:28.000
23	34445947	2024	1	23	2024-01-23 15:51:30.000	2024-01-23 15:51:30.000
24	49689450	2024	1	22	2024-01-22 22:56:12.000	2024-01-22 22:56:12.000
25	51451683	2024	1	9	2024-01-09 10:38:20.000	2024-01-09 10:38:20.000
26	59099581	2024	1	16	2024-01-16 03:39:03.000	2024-01-16 03:39:03.000
27	68243414	2024	1	6	2024-01-06 21:49:26.000	2024-01-06 21:49:26.000
28	88143456	2024	1	13	2024-01-13 17:36:17.000	2024-01-13 17:36:17.000
29	91481544	2024	1	4	2024-01-04 05:25:28.000	2024-01-04 05:25:28.000
30	92939564	2024	1	9	2024-01-09 15:59:08.000	2024-01-09 15:59:08.000
31	98725748	2024	1	30	2024-01-30 19:38:18.000	2024-01-30 19:38:18.000
32	99043470	2024	1	1	2024-01-01 04:48:22.000	2024-01-01 04:48:22.000
33	99173518	2024	1	29	2024-01-29 21:29:00.000	2024-01-29 21:29:00.000
34	99850330	2024	1	5	2024-01-05 09:46:41.000	2024-01-05 09:46:41.000
35	99998800	2024	1	5	2024-01-05 15:53:11.000	2024-01-05 15:53:11.000
36	100259006	2024	1	12	2024-01-12 04:44:18.000	2024-01-12 04:47:18.000
37	100259011	2024	1	12	2024-01-12 06:09:32.000	2024-01-12 06:12:27.000
38	100259011	2024	1	23	2024-01-23 00:05:53.000	2024-01-23 00:05:53.000
39	107090131	2024	1	29	2024-01-29 21:37:49.000	2024-01-29 21:41:07.000
40	109010462	2024	1	26	2024-01-26 03:48:37.000	2024-01-26 03:48:37.000
41	109050372	2024	1	20	2024-01-20 00:23:28.000	2024-01-20 00:27:22.000
42	109050376	2024	1	20	2024-01-20 00:21:33.000	2024-01-20 00:21:33.000
43	109050378	2024	1	20	2024-01-20 00:21:10.000	2024-01-20 00:23:07.000
44	109070092	2024	1	1	2024-01-01 01:04:29.000	2024-01-01 01:04:29.000
45	114987912	2024	1	9	2024-01-09 01:31:27.000	2024-01-09 01:31:27.000
46	114987929	2024	1	27	2024-01-27 06:20:40.000	2024-01-27 06:20:40.000
47	114987987	2024	1	9	2024-01-09 01:43:35.000	2024-01-09 01:43:35.000
48	123456795	2024	1	22	2024-01-22 19:15:51.000	2024-01-22 19:17:51.000
49	123456808	2024	1	22	2024-01-22 18:52:46.000	2024-01-22 18:54:46.000
50	129129903	2024	1	9	2024-01-09 03:31:28.000	2024-01-09 03:31:28.000
51	134565599	2024	1	26	2024-01-26 23:42:41.000	2024-01-26 23:42:41.000
52	135361816	2024	1	27	2024-01-27 22:30:07.000	2024-01-27 22:30:07.000
53	155012139	2024	1	25	2024-01-25 14:38:03.000	2024-01-25 14:38:03.000
54	166802894	2024	1	17	2024-01-17 07:59:51.000	2024-01-17 07:59:51.000
55	171012272	2024	1	4	2024-01-04 21:28:58.000	2024-01-04 21:28:58.000
56	176520315	2024	1	5	2024-01-05 03:01:51.000	2024-01-05 03:01:51.000
57	185597568	2024	1	13	2024-01-13 12:05:01.000	2024-01-13 12:05:01.000
58	195961352	2024	1	21	2024-01-21 13:06:59.000	2024-01-21 13:06:59.000
59	200000000	2024	1	17	2024-01-17 18:10:53.000	2024-01-17 18:10:53.000
60	200000000	2024	1	22	2024-01-22 15:55:00.000	2024-01-22 15:57:30.000
61	200000001	2024	1	13	2024-01-13 01:29:38.000	2024-01-13 01:29:38.000
62	200000001	2024	1	27	2024-01-27 00:03:04.000	2024-01-27 00:03:04.000
63	201999991	2024	1	18	2024-01-18 17:28:57.000	2024-01-18 17:28:57.000
64	202904088	2024	1	21	2024-01-21 08:10:10.000	2024-01-21 08:10:10.000
65	203141400	2024	1	15	2024-01-15 17:52:59.000	2024-01-15 17:52:59.000
66	203141400	2024	1	19	2024-01-19 18:03:19.000	2024-01-19 18:03:19.000
67	209017000	2024	1	26	2024-01-26 11:51:41.000	2024-01-26 11:51:41.000
68	209109000	2024	1	25	2024-01-25 20:25:05.000	2024-01-25 20:25:05.000
69	209182000	2024	1	3	2024-01-03 23:38:32.000	2024-01-03 23:39:44.000
70	209228000	2024	1	18	2024-01-18 00:04:16.000	2024-01-18 00:04:16.000
71	209228000	2024	1	19	2024-01-19 03:19:41.000	2024-01-19 03:19:41.000
72	209228000	2024	1	22	2024-01-22 01:03:40.000	2024-01-22 01:03:40.000
73	209335000	2024	1	21	2024-01-21 12:55:13.000	2024-01-21 12:55:13.000
74	209335000	2024	1	29	2024-01-29 16:56:57.000	2024-01-29 16:56:57.000
75	209513000	2024	1	23	2024-01-23 23:57:04.000	2024-01-23 23:57:04.000
76	209697000	2024	1	13	2024-01-13 10:38:26.000	2024-01-13 10:38:26.000
77	209699000	2024	1	6	2024-01-06 00:13:35.000	2024-01-06 00:13:35.000
78	209729000	2024	1	18	2024-01-18 01:55:13.000	2024-01-18 01:55:13.000
79	209854000	2024	1	24	2024-01-24 00:07:52.000	2024-01-24 00:07:52.000
80	209882000	2024	1	5	2024-01-05 17:45:35.000	2024-01-05 17:45:35.000
81	209961000	2024	1	10	2024-01-10 21:21:42.000	2024-01-10 21:21:42.000
82	209997000	2024	1	1	2024-01-01 03:34:36.000	2024-01-01 03:38:48.000
83	210059000	2024	1	16	2024-01-16 01:52:02.000	2024-01-16 01:52:02.000
84	210065000	2024	1	26	2024-01-26 00:08:35.000	2024-01-26 00:08:35.000
85	210102300	2024	1	19	2024-01-19 05:48:30.000	2024-01-19 05:48:30.000
86	210159000	2024	1	9	2024-01-09 19:40:35.000	2024-01-09 19:40:35.000
87	210210000	2024	1	17	2024-01-17 05:55:46.000	2024-01-17 05:58:46.000
88	210214000	2024	1	20	2024-01-20 04:53:22.000	2024-01-20 04:53:22.000
89	210367000	2024	1	15	2024-01-15 06:30:49.000	2024-01-15 06:30:49.000
90	210565000	2024	1	16	2024-01-16 13:18:37.000	2024-01-16 13:18:37.000
91	210568000	2024	1	6	2024-01-06 10:12:05.000	2024-01-06 10:12:05.000
92	210568000	2024	1	13	2024-01-13 10:27:29.000	2024-01-13 10:27:29.000
93	210568000	2024	1	29	2024-01-29 12:40:53.000	2024-01-29 12:40:53.000
94	211108330	2024	1	3	2024-01-03 22:30:36.000	2024-01-03 22:32:06.000
95	211108330	2024	1	7	2024-01-07 15:53:36.000	2024-01-07 15:55:03.000
96	211155620	2024	1	20	2024-01-20 14:40:31.000	2024-01-20 14:40:31.000
97	211155620	2024	1	28	2024-01-28 18:42:51.000	2024-01-28 18:42:51.000
98	211223160	2024	1	9	2024-01-09 19:51:27.000	2024-01-09 19:51:27.000
99	211223160	2024	1	15	2024-01-15 20:43:46.000	2024-01-15 20:43:46.000
100	211723180	2024	1	1	2024-01-01 12:45:57.000	2024-01-01 12:45:57.000


```

### Interpretation 

* Days with <5‑min span generally indicate 1–2 samples only → incomplete days.

---

# 9. Anomaly Summary

### **Detected Issue: Large Haversine Jumps**

Certain MMSIs show large spatial jumps between consecutive points. This does not confirm a pipeline error; these jumps may originate entirely from the raw source data.

To confirm root cause, the next required step is:

### **Next Step: Validate Against `noaa_ais_staging`**

To Check whether the same timestamp pair in staging exhibits the same jump.

---

# 10. Next Action

Use this targeted staging query for each anomalous MMSI and timestamp range:

```sql
SELECT
    basedatetime,
    lat,
    lon,
    sog
FROM noaa_ais_staging
WHERE mmsi = <target_mmsi>
  AND basedatetime BETWEEN <t_start> AND <t_end>
ORDER BY basedatetime;
```

This will confirm:

* whether anomalies originate from raw AIS, or
* whether bucket-based thinning removed critical intermediate points.

Once staging validation is complete, anomalies can be categorized definitively.

---

## 11. Overall Assessment

Aside from the isolated large-distance transitions, **all validation checks passed**, confirming that the curated pipeline behaves as designed:

* daily boundary retention is correct,
* movement-state logic is correct,
* thinning buckets operate correctly,
* voyage segmentation holds consistent,
* and the curated dataset is structurally sound.

The next step is solely to determine whether spatial anomalies are inherent in the raw AIS stream.

---

## 12. Anomaly Deep Dive

### 12.1 Objective

This section evaluates raw upstream AIS positional jumps by measuring great-circle distances between consecutive packets in the staging dataset. Any segment exceeding 50 km indicates either source‑level stitching issues, cross‑region feed mixing, or stale buffered transmissions.

---

### 12.2 SQL Used

```sql
SELECT *
FROM (
    SELECT
        mmsi,
        basedatetime,
        lat,
        lon,
        LAG(lat) OVER (PARTITION BY mmsi ORDER BY basedatetime) AS prev_lat,
        LAG(lon) OVER (PARTITION BY mmsi ORDER BY basedatetime) AS prev_lon,
        great_circle_distance(
            lat,
            lon,
            LAG(lat) OVER (PARTITION BY mmsi ORDER BY basedatetime),
            LAG(lon) OVER (PARTITION BY mmsi ORDER BY basedatetime)
        ) AS raw_segment_km
    FROM noaa_ais_all_staging
    WHERE year = 2024 AND month = 1
) t
WHERE raw_segment_km > 50
ORDER BY raw_segment_km DESC;
```

---

### 12.3 Output

#	mmsi	basedatetime	lat	lon	prev_lat	prev_lon	raw_segment_km
1	369970407	2024-01-28 22:03:43.000	13.41165	144.40868	32.62617	-117.43206	9951.593382206223
2	369207000	2024-01-21 17:57:20.000	34.04392	-125.45252	15.22524	142.11433	9285.606270607686
3	338796000	2024-01-28 06:55:39.000	36.51266	-127.58048	13.88592	143.96712	8958.837356106536
4	311000206	2024-01-25 17:47:23.000	11.57285	146.11899	46.15091	-126.83313	8856.89637932103
5	367668180	2024-01-12 16:38:58.000	-21.99536	-158.92268	48.49426	-122.68307	8626.286526927743
6	563040600	2024-01-24 01:50:37.000	10.62195	145.41528	42.25127	-131.78862	8625.900924548781
7	636019407	2024-01-26 17:57:33.000	27.48065	-77.30123	16.41515	-161.0141	8570.8704179859
8	367668180	2024-01-12 22:17:26.000	48.49418	-122.68307	-19.61996	-159.34841	8402.673735691844
9	0	2024-01-10 17:57:25.000	43.64552	-70.24838	19.19281	-157.91165	8366.362803463684
10	0	2024-01-10 17:56:16.000	19.19281	-157.91165	43.64552	-70.24838	8366.362803463684
11	0	2024-01-10 17:20:14.000	43.64554	-70.24837	19.26947	-157.9171	8361.131311219831
12	0	2024-01-10 17:19:13.000	19.26947	-157.9171	43.64551	-70.24838	8361.131258757892
13	0	2024-01-10 17:14:44.000	43.64551	-70.24838	19.28093	-157.91811	8360.36460755189
14	0	2024-01-10 17:13:38.000	19.28093	-157.91811	43.64551	-70.24838	8360.36460755189
15	0	2024-01-10 17:05:34.000	43.64552	-70.24837	19.29962	-157.91991	8359.126886198268
16	0	2024-01-10 17:04:31.000	19.29962	-157.91991	43.64552	-70.24837	8359.126886198268
17	370363000	2024-01-27 20:09:29.000	15.55652	-156.96173	38.37088	-73.79597	8355.877229065845
18	0	2024-01-10 16:17:53.000	43.64552	-70.24838	19.39658	-157.92991	8352.755530384256
19	0	2024-01-10 16:16:51.000	19.39658	-157.92991	43.64552	-70.24839	8352.754745720338
20	0	2024-01-10 16:09:54.000	43.64552	-70.24839	19.4133	-157.93156	8351.650575736594
21	0	2024-01-10 16:08:45.000	19.4133	-157.93156	43.64553	-70.24839	8351.650329275193
22	0	2024-01-10 16:06:43.000	19.41751	-157.932	43.64553	-70.24839	8351.374241479547
23	0	2024-01-10 16:07:44.000	43.64553	-70.24839	19.41751	-157.932	8351.374241479545
24	0	2024-01-10 16:03:13.000	43.64554	-70.2484	19.42692	-157.93287	8350.74722399573
25	0	2024-01-10 16:01:09.000	19.42898	-157.93302	43.64554	-70.2484	8350.607014237474
26	0	2024-01-10 15:58:14.000	43.64554	-70.2484	19.43745	-157.93365	8350.03157172507
27	0	2024-01-10 15:53:02.000	19.44581	-157.93419	43.64554	-70.2484	8349.457201300249
28	0	2024-01-10 15:48:34.000	43.64554	-70.24841	19.45732	-157.93465	8348.64341796924
29	0	2024-01-10 15:43:26.000	19.46559	-157.93481	43.64554	-70.24841	8348.04591932047
30	0	2024-01-10 15:41:23.000	43.64554	-70.2484	19.47185	-157.93501	8347.600626740717
31	0	2024-01-10 15:40:22.000	19.47185	-157.93501	43.64554	-70.24841	8347.599842268937
32	0	2024-01-10 15:38:05.000	43.64554	-70.24841	19.47908	-157.93524	8347.084580323217
33	0	2024-01-10 15:36:54.000	19.47908	-157.93524	43.64554	-70.24841	8347.084580323217
34	0	2024-01-10 15:10:04.000	43.64554	-70.24841	19.53783	-157.93827	8342.989225520485
35	0	2024-01-10 15:08:57.000	19.53783	-157.93827	43.64554	-70.24841	8342.989225520485
36	0	2024-01-10 15:05:33.000	43.64554	-70.24841	19.54748	-157.93883	8342.321515691357
37	0	2024-01-10 15:02:22.000	19.55169	-157.93907	43.64554	-70.24841	8342.029883855923
38	0	2024-01-10 14:54:54.000	43.64554	-70.24841	19.5698	-157.94003	8340.769757420538
39	0	2024-01-10 14:53:46.000	19.5698	-157.94003	43.64554	-70.24841	8340.769757420538
40	0	2024-01-10 14:48:14.000	43.64554	-70.24841	19.58365	-157.94061	8339.794017428845
41	0	2024-01-10 14:47:11.000	19.58365	-157.94061	43.64554	-70.24841	8339.794017428845
42	0	2024-01-10 14:42:43.000	43.64554	-70.24841	19.5954	-157.94123	8338.976296972294
43	0	2024-01-10 14:41:36.000	19.5954	-157.94123	43.64554	-70.24841	8338.976296972294
44	0	2024-01-10 14:22:23.000	43.64554	-70.24841	19.6382	-157.94329	8335.982462231084
45	0	2024-01-10 14:21:16.000	19.6382	-157.94329	43.64554	-70.24841	8335.982462231084
46	0	2024-01-10 14:13:13.000	43.64554	-70.24842	19.65788	-157.94402	8334.588208956551
47	0	2024-01-10 14:09:06.000	19.66441	-157.94423	43.64554	-70.24842	8334.123340807435
48	0	2024-01-10 14:06:54.000	43.64554	-70.24842	19.67195	-157.94438	8333.57933564387
49	0	2024-01-10 14:05:35.000	19.67195	-157.94438	43.64554	-70.24842	8333.57933564387
50	0	2024-01-10 14:01:04.000	43.64554	-70.24841	19.68364	-157.94466	8332.740445935015
51	0	2024-01-10 13:57:28.000	19.68901	-157.94484	43.64554	-70.24841	8332.358768020325
52	0	2024-01-10 13:51:54.000	43.64553	-70.24841	19.70313	-157.94502	8331.332473218652
53	0	2024-01-10 13:48:50.000	19.70743	-157.94505	43.64553	-70.24841	8331.017922779325
54	0	2024-01-10 13:45:24.000	43.64553	-70.24841	19.7172	-157.94515	8330.305750404465
55	0	2024-01-10 13:43:15.000	19.7194	-157.94509	43.64553	-70.24841	8330.138919705816
56	0	2024-01-10 13:35:14.000	43.64553	-70.24841	19.73906	-157.94511	8328.691719333965
57	0	2024-01-10 13:33:08.000	19.74125	-157.94511	43.64553	-70.24841	8328.530342732636
58	0	2024-01-10 13:26:32.000	19.75581	-157.94501	43.64552	-70.2484	8327.450679886088
59	0	2024-01-10 13:27:34.000	43.64552	-70.24841	19.75581	-157.94501	8327.449896127982
60	0	2024-01-10 13:22:03.000	43.64552	-70.2484	19.76827	-157.94486	8326.52085275336
61	0	2024-01-10 13:19:54.000	19.77054	-157.94485	43.64552	-70.24841	8326.352033353407
62	0	2024-01-10 13:16:24.000	43.64552	-70.24841	19.78068	-157.94478	8325.599458177225
63	0	2024-01-10 13:14:21.000	19.78297	-157.94475	43.64552	-70.2484	8325.429173671597
64	0	2024-01-10 13:10:54.000	43.64552	-70.2484	19.79308	-157.94464	8324.675711529715
65	0	2024-01-10 13:08:46.000	19.79542	-157.94461	43.64552	-70.24841	8324.500184617695
66	0	2024-01-10 13:07:44.000	43.64552	-70.24841	19.79993	-157.94456	8324.164010650991
67	0	2024-01-10 13:06:43.000	19.79993	-157.94456	43.64552	-70.24841	8324.164010650991
68	0	2024-01-10 13:03:13.000	43.64552	-70.24841	19.80997	-157.94456	8323.42437655317
69	0	2024-01-10 13:01:10.000	19.81229	-157.94461	43.64552	-70.24841	8323.257387411137
70	0	2024-01-10 12:57:43.000	43.64552	-70.24841	19.82246	-157.94456	8322.504295527326
71	0	2024-01-10 12:56:37.000	19.82246	-157.94456	43.64552	-70.24841	8322.504295527326
72	0	2024-01-10 12:52:03.000	43.64552	-70.24841	19.83486	-157.94457	8321.59167346641
73	0	2024-01-10 12:46:57.000	19.84383	-157.94445	43.64552	-70.24841	8320.921553387663
74	0	2024-01-10 12:42:25.000	19.854	-157.94417	43.64552	-70.24841	8320.150536068091
75	0	2024-01-10 12:43:34.000	43.64553	-70.24841	19.854	-157.94417	8320.150282992156
76	0	2024-01-10 12:41:24.000	43.64552	-70.24841	19.8585	-157.94405	8319.809693240159
77	0	2024-01-10 12:38:20.000	19.86294	-157.94388	43.64553	-70.24841	8319.469105068172
78	0	2024-01-10 12:33:54.000	43.64553	-70.24841	19.87556	-157.94348	8318.508308520464
79	0	2024-01-10 12:31:45.000	19.87788	-157.94342	43.64553	-70.24841	8318.33274604548
80	0	2024-01-10 12:26:12.000	19.8905	-157.94294	43.64552	-70.24841	8317.365994322705
81	0	2024-01-10 12:27:14.000	43.64553	-70.24841	19.8905	-157.94294	8317.365740726316
82	0	2024-01-10 12:22:43.000	43.64553	-70.2484	19.90082	-157.94253	8316.574423749511
83	0	2024-01-10 12:21:39.000	19.90082	-157.94253	43.64552	-70.24841	8316.57389408839
84	0	2024-01-10 12:18:13.000	43.64552	-70.24841	19.91128	-157.94201	8315.762901157426
85	0	2024-01-10 12:16:04.000	19.91354	-157.9419	43.64552	-70.2484	8315.588649279462
86	0	2024-01-10 12:11:29.000	19.92398	-157.94137	43.64552	-70.2484	8314.778388281386
87	0	2024-01-10 12:12:33.000	43.64553	-70.2484	19.92398	-157.94137	8314.778134212806
88	0	2024-01-10 12:08:03.000	43.64552	-70.2484	19.93453	-157.94083	8313.959279734578
89	0	2024-01-10 12:05:55.000	19.93681	-157.94073	43.64552	-70.2484	8313.78357207693
90	0	2024-01-10 12:00:04.000	43.64552	-70.2484	19.95093	-157.94006	8312.69148310172
91	0	2024-01-10 11:59:49.000	19.95093	-157.94006	43.64553	-70.2484	8312.69122865366
92	0	2024-01-10 11:55:20.000	19.96147	-157.93965	43.64552	-70.2484	8311.883384466388
93	0	2024-01-10 11:56:23.000	43.64552	-70.2484	19.96147	-157.93965	8311.883384466388
94	0	2024-01-10 11:54:15.000	43.64552	-70.2484	19.96625	-157.93937	8311.509547599671
95	0	2024-01-10 11:52:13.000	19.96865	-157.9393	43.64552	-70.2484	8311.327378459557
96	0	2024-01-10 11:48:45.000	43.64552	-70.2484	19.97925	-157.93877	8310.505523548845
97	0	2024-01-10 11:45:38.000	19.98387	-157.93849	43.64552	-70.2484	8310.14349247317
98	0	2024-01-10 11:42:13.000	43.64552	-70.2484	19.9946	-157.93794	8309.310553848974
99	0	2024-01-10 11:41:05.000	19.9946	-157.93794	43.64552	-70.2484	8309.310553848974
100	0	2024-01-10 11:39:03.000	19.99943	-157.93764	43.64552	-70.2484	8308.931521545872


---

### 12.4 Interpretation

Raw segment distances above 50 km are present in upstream staging data. These anomalies occur before sampling and therefore are not produced by the thinning logic. The pattern aligns with NOAA AIS broadcast‑domain mixing, where transmissions from different ocean regions merge into a single MMSI timeline.

Key examples:

* MMSI 369970407: Guam to San Diego transition (~9951 km)
* MMSI 369207000: Hawaii to West Coast (~9285 km)
* MMSI 338796000: Hawaii to Northern Pacific (~8958 km)
* MMSI 311000206: Micronesia to West Coast (~8856 km)
* MMSI 367668180: Hawaii to Pacific Northwest (~8626 km)
* MMSI 0: thousands of entries with extreme jumps, indicative of corrupted or synthetic reports

Technical implications:

1. Staging integrates multiple geographic feeds without geofencing, producing cross‑ocean jumps.
2. The sampler is not responsible; it only preserves bucket endpoints and day endpoints.
3. These jumps are upstream defects and require cleansing or domain partitioning before sampling.
4. Unfiltered, they propagate into curated outputs as large segmentdistancekm values.

---

### 12.5 Metric and Detection Strategy

A geofence‑based anomaly score can be computed to automatically flag or filter extreme transitions.

Recommended detection logic:

1. Compute raw_segment_km for every consecutive position.
2. Define thresholds:

   * `>50 km` = suspicious
   * `>500 km` = hard anomaly
   * `>1500 km` = geofence violation
3. Maintain MMSI‑level anomaly ratios: `anomalous_segments / total_segments`.
4. Track regional transitions using bounding boxes (e.g., West Coast, Hawaii, Guam, Alaska). A single MMSI switching between these within <2 hours indicates feed mixing.
5. Persist anomaly flags so downstream components can choose between filtering, weighting, or reassigning these packets.

This provides visibility without discarding data outright, enabling vessel‑tracking applications to preserve true long‑distance voyages while isolating feed‑level corruption.
